# 🔧 Dify工作流导入错误快速修复指南

## 问题诊断

您遇到的 `400 Bad Request` 错误是由于工作流配置文件格式不符合Dify规范导致的。

## ✅ 解决方案

### 1. 使用修复版文件

**请使用以下修复版文件替代原始版本：**

- ❌ ~~`基础版_图文问答机器人.yml`~~ 
- ✅ **`基础版_图文问答机器人_修复版.yml`**

- ❌ ~~`进阶版_智能多模态助手.yml`~~
- ✅ **`进阶版_智能多模态助手_修复版.yml`**

- ❌ ~~`高级版_企业级可扩展问答系统.yml`~~
- ✅ **`高级版_企业级可扩展问答系统_修复版.yml`**

### 2. 主要修复内容

#### 节点ID格式修复
```yaml
# ❌ 错误格式
id: start
id: document-extractor
id: knowledge-retrieval

# ✅ 正确格式  
id: '1752659131948'
id: '1752659131949'
id: '1752659371747'
```

#### 边连接修复
```yaml
# ✅ 正确的边配置
- data:
    isInIteration: false
    sourceType: start
    targetType: document-extractor
  id: 1752659131948-1752659131949
  source: '1752659131948'
  sourceHandle: source
  target: '1752659131949'
  targetHandle: target
  type: custom
  zIndex: 0
```

#### 节点属性完善
```yaml
# ✅ 完整的节点配置
- data:
    # ... 节点数据
  height: 116
  id: '1752659131948'
  position:
    x: 50
    y: 300
  positionAbsolute:
    x: 50
    y: 300
  selected: false
  sourcePosition: right    # ✅ 新增
  targetPosition: left     # ✅ 新增
  type: custom
  width: 244
```

#### 提示词模板修复
```yaml
# ✅ 正确的提示词格式
prompt_template:
- edition_type: basic      # ✅ 新增
  id: 7b1c4a52-795e-4abb-93f7-dba569ea3a63
  role: system
  text: |
    你是一个专业的智能助手...
```

## 🚀 快速导入步骤

### 步骤1: 选择合适版本
- **新手用户**: 使用基础版
- **中级用户**: 使用进阶版  
- **企业用户**: 使用高级版

### 步骤2: 导入工作流
1. 打开Dify管理界面
2. 进入"工作流"页面
3. 点击"导入"按钮
4. 选择对应的**修复版**YML文件
5. 点击确认导入

### 步骤3: 配置知识库ID
**重要**: 必须替换为您实际的知识库ID

在导入后的工作流中找到知识检索节点，修改：
```yaml
dataset_ids:
- your-actual-knowledge-base-id-here  # 替换这里
```

### 步骤4: 验证模型配置
确保以下模型在您的Dify中可用：
- `qwen-turbo` 或 `qwen-max`
- `qwen-vl-max` (用于图像理解)
- `gte-rerank` (用于重排序)

## 🔍 验证导入成功

### 检查清单
- [ ] 工作流导入无错误
- [ ] 所有节点正确显示
- [ ] 节点间连线正常
- [ ] 知识库ID已配置
- [ ] 模型配置正确

### 简单测试
1. 在工作流中输入测试问题
2. 上传一个测试文档
3. 检查是否正常返回回答

## ❗ 常见错误及解决

### 错误1: 知识库ID不存在
```
解决: 在Dify知识库页面获取正确的ID并替换
```

### 错误2: 模型不可用
```
解决: 检查模型配置页面，确保模型已正确配置
```

### 错误3: 节点连接错误
```
解决: 使用修复版文件，不要手动修改节点连接
```

## 📞 技术支持

如果仍有问题：
1. 检查Dify版本是否为最新
2. 查看控制台详细错误信息
3. 参考 `修复版工作流使用说明.md` 获取详细信息

## ✨ 修复版优势

- ✅ **格式正确**: 符合Dify规范，导入无错误
- ✅ **功能完整**: 保留所有原始功能
- ✅ **易于配置**: 清晰的配置说明
- ✅ **测试通过**: 所有YAML格式验证通过

---

**立即行动**: 请使用修复版文件重新导入，问题将得到解决！
