# Dify 图文问答机器人工作流使用说明

## 概述

本项目提供了3个版本的Dify工作流配置，用于构建基于本地知识库的图文问答机器人。每个版本都支持多模态输入输出，具有不同的复杂度和功能特性。

## 知识库预处理

在使用工作流之前，请先运行 `document_processor.py` 脚本对知识库进行预处理：

```bash
python document_processor.py
```

该脚本会：
- 处理Word、PDF、Excel、PowerPoint等格式文档
- 提取文本和图片内容
- 转换为Q&A格式
- 补充上下文信息
- 输出为Word文档格式

处理后的知识库文件位于 `已处理知识库` 目录中。

## 工作流版本说明

### 1. 基础版 - 图文问答机器人

**文件**: `基础版_图文问答机器人.yml`

**特点**:
- 简单易用，适合快速部署
- 支持文本、图片、语音、文件输入
- 基础的问题分类和知识检索
- 图文混排输出

**节点流程**:
```
开始 → 文档提取器 → 问题分类 → 知识检索 → 回答生成 → 直接回复
```

**适用场景**:
- 小型团队或个人使用
- 基础的客服问答
- 简单的文档查询

**配置要点**:
- 需要配置知识库ID (`dataset_ids`)
- 建议使用 `qwen-vl-max` 模型支持视觉理解
- 支持最多10个文件上传

### 2. 进阶版 - 智能多模态助手

**文件**: `进阶版_智能多模态助手.yml`

**特点**:
- 增强的逻辑处理能力
- 条件分支和工具调用
- 智能代理功能
- 变量聚合处理

**节点流程**:
```
开始 → 文档提取器 → 智能问题分类 → 条件分支
                                    ├─ 知识检索 ─┐
                                    └─ 工具调用 ─┤
                                              ↓
变量聚合 → 智能代理 → 最终回答生成 → 直接回复
```

**适用场景**:
- 中型企业应用
- 需要工具集成的场景
- 复杂的多步骤处理

**配置要点**:
- 支持多种工具调用 (web_scraper, image_analyzer等)
- 智能代理可调用计算器、网络搜索等工具
- 支持最多15个文件上传
- 包含敏感词过滤功能

### 3. 高级版 - 企业级可扩展问答系统

**文件**: `高级版_企业级可扩展问答系统.yml` + `高级版_企业级可扩展问答系统_续.yml`

**特点**:
- 企业级架构设计
- 支持MCP集成
- 复杂业务逻辑处理
- 多知识库支持
- 批量数据处理

**节点流程**:
```
开始 → 参数提取 → 文档提取器 → 企业级问题分类 → 主要条件分支
                                                    ├─ 迭代处理器 → 专业知识库检索 ─┐
                                                    └─ 主知识库检索 ─────────────┤
                                                                            ↓
外部API调用 → 代码执行器 → MCP工具集成 → 智能编排代理 → 企业数据聚合 → 模板转换器 → 企业级回答生成 → 直接回复
```

**适用场景**:
- 大型企业部署
- 复杂业务流程自动化
- 多系统集成需求
- 高并发处理场景

**配置要点**:
- 支持会话变量和环境变量
- 集成MCP服务器 (Zapier, 数据库, 分析工具等)
- 支持最多50个文件批量上传
- 包含自定义代码执行器
- 企业级安全和权限控制

## 部署步骤

### 1. 准备工作

1. 确保已安装Dify平台
2. 配置好大语言模型 (推荐通义千问系列)
3. 运行知识库预处理脚本

### 2. 导入工作流

1. 登录Dify管理界面
2. 进入"工作流"页面
3. 点击"导入"按钮
4. 选择对应版本的YML文件
5. 根据需要调整配置

### 3. 配置知识库

1. 在Dify中创建知识库
2. 上传预处理后的Word文档
3. 等待向量化处理完成
4. 在工作流中配置知识库ID

### 4. 模型配置

推荐模型配置：
- **文本理解**: qwen-turbo / qwen-max
- **视觉理解**: qwen-vl-max
- **重排序**: gte-rerank

### 5. 测试和优化

1. 使用测试数据验证工作流
2. 调整检索参数和提示词
3. 优化响应速度和准确性

## 扩展性说明

### 知识库扩展

- 支持添加新的知识库数据源
- 可以配置不同领域的专业知识库
- 支持实时更新知识库内容

### 工具集成

- 可以添加自定义工具
- 支持MCP协议集成第三方服务
- 可以调用企业内部API

### 模型升级

- 支持更换不同的大语言模型
- 可以配置多模型协同工作
- 支持模型参数动态调整

## 注意事项

1. **性能优化**: 根据实际使用情况调整检索参数和模型配置
2. **安全考虑**: 配置敏感词过滤和访问权限控制
3. **成本控制**: 合理设置模型调用频率和token限制
4. **监控告警**: 建议配置系统监控和异常告警
5. **数据备份**: 定期备份知识库和配置文件

## 技术支持

如有问题，请参考：
1. Dify官方文档: https://docs.dify.ai/zh-hans/introduction
2. 项目GitHub仓库
3. 社区论坛和技术交流群

## 更新日志

- v1.0: 初始版本，包含3个工作流版本
- 支持多模态输入输出
- 集成MCP工具和企业级功能
